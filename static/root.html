{{#if !broadcasterSockId}}
<div>
    <button disabled={{ broadcasterSockId || videoIsPlaying}} primary on-click="startBroadcast">Share my screen</button>
</div>
{{/if}}

{{#if !broadcasterSockId && videoIsPlaying}}
<p>Your screen is now visible at:  
<a href="{{loc}}?id={{mysockid}}" target="_blank">{{loc}}?id={{mysockid}}</a>
</p>
<!-- <qrcode url="{{loc}}?id={{mysockid}}"></qrcode> -->
{{/if}}
<div id="vn">
    <video controls id="video"></video>
    {{#if !videoIsPlaying}}<noise id="noise"></noise>{{/if}}
</div>
<style>
    #video {
        width: 100%;
    }
    #vn{
        width: 100%;
        position:relative;
    }
</style>

    
<script>
//        var anime = require('animejs');
        component.exports = {
            onrender: function () {
                var self = this;
                /*
                self.on('installScreenCaptureExtension', function(){
                    window.installScreenCaptureExtension();
                })
                */
                this.stream=null;
                var broadcasterSockId = document.location.search.split('=').pop();
                self.set('broadcasterSockId', broadcasterSockId);
                self.on('startBroadcast', function(){
                    //getScreenId(function (error, sourceId, screen_constraints) {
                        //console.log('screen_constraints',screen_constraints)
                        //navigator.getUserMedia = navigator.mozGetUserMedia || navigator.webkitGetUserMedia;
                        let stream = null;
                        let displayMediaOptions = {};
                        try {    
                          navigator.mediaDevices.getDisplayMedia(displayMediaOptions).then(function(stream){
                            self.stream=stream;
                            document.getElementById('video').srcObject = stream;
                            document.getElementById('video').play();
                            self.set('videoIsPlaying',true);
                          });
                        } catch(err) {
                          console.error("stream Error: " + err);
                        }                        
                    //});
                })
                if (!broadcasterSockId) { // you are broadcaster
                    self.set('mysockid', socket.id);
                } else {
                    socket.emit('initP2PWith', broadcasterSockId);
                    initP2PWith(broadcasterSockId, false);
                }
            },
            data:function(){
                return {
                      mysockid:null
                    , loc: document.location.href
                    , broadcasterSockId:null
                    , videoIsPlaying:false
                    //, chromeExtensionInstalled:false
                }
            }
        }        
    
</script>
    


